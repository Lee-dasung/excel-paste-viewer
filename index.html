<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>파파고 완전 복사</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Malgun Gothic", "Segoe UI", Roboto, sans-serif;
      background-color: #f7f9fc;
      margin: 0;
      padding: 20px;
      line-height: 1.5;
    }
    
    .papago-container {
      max-width: 800px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }
    
    .papago-header {
      background: linear-gradient(135deg, #1ec800 0%, #0fb300 100%);
      color: white;
      padding: 24px 32px;
      text-align: center;
    }
    
    .papago-header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
    }
    
    .papago-main {
      padding: 32px;
    }
    
    /* 파파고와 동일한 스타일 */
    .translation-container {
      display: flex;
      gap: 16px;
      min-height: 300px;
    }
    
    .source-panel, .target-panel {
      flex: 1;
      border: 1px solid #e0e4e7;
      border-radius: 8px;
      overflow: hidden;
      background: #ffffff;
    }
    
    .panel-header {
      background: #f8f9fa;
      padding: 12px 16px;
      border-bottom: 1px solid #e0e4e7;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
    }
    
    /* 파파고 textarea와 완전 동일하게 */
    .papago-textarea {
      width: 100%;
      min-height: 250px;
      max-height: 400px;
      padding: 16px;
      border: none;
      outline: none;
      resize: none;
      font-family: inherit;
      font-size: 16px;
      line-height: 1.5;
      background: transparent;
      box-sizing: border-box;
    }
    
    .papago-textarea::placeholder {
      color: #9ca3af;
      font-style: normal;
    }
    
    .papago-textarea::-webkit-scrollbar {
      width: 6px;
    }
    
    .papago-textarea::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    .papago-textarea::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
    }
    
    .papago-btn {
      padding: 10px 20px;
      border: 1px solid #e0e4e7;
      border-radius: 6px;
      background: white;
      color: #495057;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .papago-btn:hover {
      border-color: #1ec800;
      background: #f8fff8;
    }
    
    .papago-btn.primary {
      background: #1ec800;
      color: white;
      border-color: #1ec800;
    }
    
    .papago-btn.primary:hover {
      background: #0fb300;
    }
    
    .result-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #e0e4e7;
    }
    
    .result-area {
      background: #f8f9fa;
      border: 1px solid #e0e4e7;
      border-radius: 8px;
      padding: 20px;
      min-height: 200px;
      max-height: 400px;
      overflow: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      background: white;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    table th, table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #e0e4e7;
    }
    
    table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #495057;
    }
    
    table tr:hover {
      background: #f8fff8;
    }
    
    .status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 6px;
      color: white;
      font-size: 13px;
      font-weight: 500;
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .status.show {
      transform: translateX(0);
    }
    
    .status.success {
      background: #28a745;
    }
    
    .status.error {
      background: #dc3545;
    }
    
    .debug-info {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    @media (max-width: 768px) {
      .translation-container {
        flex-direction: column;
      }
      
      .papago-main {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="papago-container">
    <div class="papago-header">
      <h1>파파고 방식 완전 복사</h1>
      <p>보안 PC에서 작동하는 파파고 방식을 정확히 따라함</p>
    </div>
    
    <div class="papago-main">
      <div class="debug-info" id="debugInfo">
        🔍 <strong>디버그 모드:</strong> 클립보드 이벤트를 실시간으로 감지합니다.
      </div>
      
      <div class="translation-container">
        <div class="source-panel">
          <div class="panel-header">
            데이터 입력 (파파고 방식)
          </div>
          <textarea 
            class="papago-textarea" 
            id="sourceText"
            placeholder="여기에 텍스트를 붙여넣으세요...

엑셀 데이터도 텍스트 형태로 붙여넣기 가능
탭이나 콤마로 구분된 데이터 지원"
            spellcheck="false"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
          ></textarea>
        </div>
        
        <div class="target-panel">
          <div class="panel-header">
            처리 결과
          </div>
          <div class="result-area" id="targetArea">
            <div style="text-align: center; color: #9ca3af; padding: 80px 20px;">
              입력된 데이터가 여기에 표시됩니다
            </div>
          </div>
        </div>
      </div>
      
      <div class="controls">
        <button class="papago-btn primary" onclick="processText()">📊 표로 변환</button>
        <button class="papago-btn" onclick="clearAll()">🗑️ 지우기</button>
        <button class="papago-btn" onclick="testClipboard()">🔍 클립보드 테스트</button>
        <button class="papago-btn" onclick="copyResult()">📋 결과 복사</button>
      </div>
      
      <div class="result-section">
        <h3>변환된 표</h3>
        <div class="result-area" id="tableResult">
          <div style="text-align: center; color: #9ca3af; padding: 40px 20px;">
            변환된 표가 여기에 표시됩니다
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="status" id="status"></div>

  <script>
    const sourceText = document.getElementById('sourceText');
    const targetArea = document.getElementById('targetArea');
    const tableResult = document.getElementById('tableResult');
    const debugInfo = document.getElementById('debugInfo');
    const status = document.getElementById('status');

    let eventCount = 0;

    // 상태 메시지 표시
    function showStatus(message, type = 'success') {
      status.textContent = message;
      status.className = `status ${type} show`;
      setTimeout(() => {
        status.classList.remove('show');
      }, 3000);
    }

    // 디버그 정보 업데이트
    function updateDebug(message) {
      eventCount++;
      debugInfo.innerHTML = `🔍 <strong>이벤트 ${eventCount}:</strong> ${message}`;
    }

    // 파파고와 동일한 이벤트 리스너들
    sourceText.addEventListener('paste', function(event) {
      updateDebug('paste 이벤트 감지됨');
      console.log('paste event triggered');
      
      // 기본 동작 허용 (파파고 방식)
      setTimeout(() => {
        const value = sourceText.value;
        if (value.trim()) {
          updateDebug(`텍스트 감지됨 (${value.length}자)`);
          targetArea.innerHTML = `<pre style="white-space: pre-wrap; font-family: 'Courier New', monospace;">${value}</pre>`;
          showStatus('텍스트가 붙여넣어졌습니다!');
        }
      }, 50);
    });

    sourceText.addEventListener('input', function(event) {
      updateDebug('input 이벤트 감지됨');
      console.log('input event triggered');
      
      const value = sourceText.value;
      if (value.trim()) {
        targetArea.innerHTML = `<pre style="white-space: pre-wrap; font-family: 'Courier New', monospace;">${value}</pre>`;
      }
    });

    sourceText.addEventListener('change', function(event) {
      updateDebug('change 이벤트 감지됨');
      console.log('change event triggered');
    });

    sourceText.addEventListener('keydown', function(event) {
      if (event.ctrlKey && event.key === 'v') {
        updateDebug('Ctrl+V 키 조합 감지됨');
        console.log('Ctrl+V detected');
      }
    });

    sourceText.addEventListener('focus', function(event) {
      updateDebug('포커스 감지됨');
      console.log('focus event');
    });

    sourceText.addEventListener('blur', function(event) {
      updateDebug('포커스 해제됨');
      console.log('blur event');
    });

    // 클립보드 테스트
    function testClipboard() {
      updateDebug('클립보드 접근 테스트 중...');
      
      // 여러 방법으로 클립보드 테스트
      if (navigator.clipboard) {
        navigator.clipboard.readText().then(text => {
          updateDebug(`클립보드 읽기 성공: ${text.substring(0, 50)}...`);
          showStatus('클립보드 접근 가능!', 'success');
        }).catch(err => {
          updateDebug('클립보드 API 접근 실패');
          showStatus('클립보드 API 차단됨', 'error');
        });
      } else {
        updateDebug('클립보드 API 미지원');
        showStatus('클립보드 API 미지원', 'error');
      }
    }

    // 텍스트 처리
    function processText() {
      const text = sourceText.value.trim();
      
      if (!text) {
        showStatus('처리할 텍스트가 없습니다!', 'error');
        return;
      }

      updateDebug('텍스트 처리 시작');
      
      try {
        const result = parseToTable(text);
        tableResult.innerHTML = result;
        showStatus('표로 변환 완료!');
        updateDebug('표 변환 성공');
      } catch (error) {
        showStatus('변환 중 오류 발생!', 'error');
        updateDebug(`변환 오류: ${error.message}`);
      }
    }

    // 표 변환 함수
    function parseToTable(text) {
      const lines = text.split('\n').filter(line => line.trim());
      
      if (lines.length === 0) {
        return '<div style="text-align: center; color: #9ca3af;">변환할 데이터가 없습니다</div>';
      }

      // 구분자 감지
      let delimiter = '\t';
      const firstLine = lines[0];
      if (firstLine.includes(',') && !firstLine.includes('\t')) {
        delimiter = ',';
      } else if (firstLine.includes('|')) {
        delimiter = '|';
      } else if (!firstLine.includes('\t') && firstLine.includes(' ')) {
        delimiter = /\s+/;
      }

      let html = '<table>';
      
      lines.forEach((line, index) => {
        html += '<tr>';
        const cells = typeof delimiter === 'string' ? line.split(delimiter) : line.split(delimiter);
        
        cells.forEach(cellText => {
          const tag = index === 0 ? 'th' : 'td';
          html += `<${tag}>${cellText.trim() || '&nbsp;'}</${tag}>`;
        });
        
        html += '</tr>';
      });
      
      html += '</table>';
      
      const delimiterName = delimiter === '\t' ? '탭' : 
                           delimiter === ',' ? '콤마' : 
                           delimiter === '|' ? '파이프' : '공백';
      
      html += `<div style="text-align: center; color: #666; margin-top: 15px; font-size: 14px;">
        📊 ${lines.length}행 × ${lines[0].split(delimiter).length}열 (구분자: ${delimiterName})
      </div>`;
      
      return html;
    }

    // 전체 지우기
    function clearAll() {
      if (confirm('모든 내용을 지우시겠습니까?')) {
        sourceText.value = '';
        targetArea.innerHTML = '<div style="text-align: center; color: #9ca3af; padding: 80px 20px;">입력된 데이터가 여기에 표시됩니다</div>';
        tableResult.innerHTML = '<div style="text-align: center; color: #9ca3af; padding: 40px 20px;">변환된 표가 여기에 표시됩니다</div>';
        updateDebug('모든 내용 삭제됨');
        showStatus('내용이 삭제되었습니다');
      }
    }

    // 결과 복사
    function copyResult() {
      const tables = tableResult.querySelectorAll('table');
      if (tables.length === 0) {
        showStatus('복사할 표가 없습니다!', 'error');
        return;
      }

      try {
        let textContent = '';
        tables[0].querySelectorAll('tr').forEach(row => {
          const cells = Array.from(row.querySelectorAll('th, td'));
          const rowText = cells.map(cell => cell.textContent.trim()).join('\t');
          textContent += rowText + '\n';
        });

        const tempTextarea = document.createElement('textarea');
        tempTextarea.value = textContent;
        document.body.appendChild(tempTextarea);
        tempTextarea.select();
        
        if (document.execCommand('copy')) {
          showStatus('클립보드에 복사되었습니다!');
          updateDebug('복사 성공');
        } else {
          throw new Error('복사 실패');
        }
        
        document.body.removeChild(tempTextarea);
      } catch (error) {
        showStatus('복사 기능이 제한되어 있습니다', 'error');
        updateDebug('복사 실패');
      }
    }

    // 페이지 로드 시 초기화
    window.addEventListener('load', function() {
      updateDebug('페이지 로드 완료 - 파파고 방식 활성화');
      sourceText.focus();
      
      // 클립보드 권한 확인
      if ('permissions' in navigator) {
        navigator.permissions.query({name: 'clipboard-read'}).then(result => {
          updateDebug(`클립보드 권한: ${result.state}`);
        });
      }
    });

    // 전역 이벤트 감지
    document.addEventListener('paste', function(event) {
      updateDebug('전역 paste 이벤트 감지됨');
    });

    // 키보드 이벤트 감지
    document.addEventListener('keydown', function(event) {
      if (event.ctrlKey && event.key === 'v') {
        updateDebug('전역 Ctrl+V 감지됨');
      }
    });
  </script>
</body>
</html>
