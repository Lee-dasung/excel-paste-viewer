<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¶™ì—¬ë„£ê¸° í†µí•© ë·°ì–´</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Malgun Gothic", "ë§‘ì€ ê³ ë”•", helvetica, "Apple SD Gothic Neo", sans-serif;
      background-color: #f7f9fc;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #1ec800 0%, #0fb300 100%);
      color: white;
      padding: 24px 32px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
    }
    
    .header p {
      margin: 8px 0 0 0;
      opacity: 0.9;
      font-size: 14px;
    }
    
    .content {
      padding: 32px;
    }
    
    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 8px 16px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      font-size: 13px;
      color: #374151;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: #f9fafb;
      border-color: #1ec800;
    }
    
    .btn-primary {
      background: #1ec800;
      color: white;
      border-color: #1ec800;
    }
    
    .btn-primary:hover {
      background: #0fb300;
    }
    
    #pasteArea {
      width: 100%;
      min-height: 400px;
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      padding: 24px;
      background: #fafbfc;
      outline: none;
      font-size: 14px;
      line-height: 1.6;
      color: #374151;
      position: relative;
      transition: border-color 0.2s;
    }
    
    #pasteArea:focus {
      border-color: #1ec800;
      background: #ffffff;
    }
    
    #pasteArea:empty:before {
      content: 'ì—‘ì…€ í‘œ, í…ìŠ¤íŠ¸, ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (Ctrl+V)\A\AğŸ“Š ì—‘ì…€ í‘œ: ì…€ ë²”ìœ„ ì„ íƒ í›„ Ctrl+C â†’ Ctrl+V\AğŸ“ í…ìŠ¤íŠ¸: ì¼ë°˜ í…ìŠ¤íŠ¸ë‚˜ êµ¬ì¡°í™”ëœ ë°ì´í„°\AğŸ–¼ï¸ ì´ë¯¸ì§€: ìŠ¤í¬ë¦°ìƒ·ì´ë‚˜ ë³µì‚¬ëœ ì´ë¯¸ì§€';
      color: #9ca3af;
      white-space: pre-line;
      font-style: normal;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      pointer-events: none;
    }
    
    /* íŒŒíŒŒê³  ìŠ¤íƒ€ì¼ í…Œì´ë¸” */
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 16px 0;
      font-size: 13px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
    }
    
    table td, table th {
      border: 1px solid #e5e7eb;
      padding: 8px 12px;
      text-align: left;
      vertical-align: top;
      background: white;
    }
    
    table th {
      background: #f8fafc;
      font-weight: 600;
      color: #374151;
    }
    
    table tr:nth-child(even) td {
      background: #f9fafb;
    }
    
    /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
    .image-container {
      margin: 16px 0;
      text-align: center;
    }
    
    .image-container img {
      max-width: 100%;
      height: auto;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* í…ìŠ¤íŠ¸ ë¸”ë¡ */
    .text-block {
      margin: 16px 0;
      padding: 16px;
      background: #f8fafc;
      border-radius: 6px;
      border-left: 3px solid #1ec800;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 6px;
      color: white;
      font-size: 13px;
      font-weight: 500;
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .status.show {
      transform: translateX(0);
    }
    
    .status.success {
      background: #1ec800;
    }
    
    .status.error {
      background: #dc2626;
    }
    
    .item-info {
      position: absolute;
      top: 8px;
      right: 12px;
      background: rgba(30, 200, 0, 0.1);
      color: #1ec800;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“‹ ë¶™ì—¬ë„£ê¸° í†µí•© ë·°ì–´</h1>
      <p>ì—‘ì…€ í‘œì™€ í…ìŠ¤íŠ¸ë¥¼ ì•ˆì „í•˜ê²Œ í™•ì¸í•˜ì„¸ìš”</p>
    </div>
    
    <div class="content">
      <div class="controls">
        <button class="btn btn-primary" onclick="focusPasteArea()">ğŸ“‹ ë¶™ì—¬ë„£ê¸° í™œì„±í™”</button>
        <button class="btn" onclick="downloadAsHtml()">ğŸ’¾ HTML ì €ì¥</button>
        <button class="btn" onclick="copyAllContent()">ğŸ“„ ì „ì²´ ë³µì‚¬</button>
        <button class="btn" onclick="clearAll()">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
      </div>
      
      <div id="pasteArea" contenteditable="true">
        <div class="item-info" id="itemInfo" style="display: none;">í•­ëª©: 0</div>
      </div>
    </div>
  </div>
  
  <div class="status" id="status"></div>

  <script>
    const pasteArea = document.getElementById('pasteArea');
    const itemInfo = document.getElementById('itemInfo');
    const status = document.getElementById('status');
    let itemCount = 0;

    // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
    function showStatus(message, type = 'success') {
      status.textContent = message;
      status.className = `status ${type} show`;
      setTimeout(() => {
        status.classList.remove('show');
      }, 3000);
    }

    // í•­ëª© ìˆ˜ ì—…ë°ì´íŠ¸
    function updateItemCount() {
      itemCount++;
      itemInfo.textContent = `í•­ëª©: ${itemCount}`;
      itemInfo.style.display = 'block';
    }

    // í•µì‹¬ ë¶™ì—¬ë„£ê¸° ë¡œì§ (íŒŒíŒŒê³  ìŠ¤íƒ€ì¼)
    pasteArea.addEventListener('paste', function (e) {
      e.preventDefault();
      
      const clipboardData = e.clipboardData;
      const html = clipboardData.getData('text/html');
      const text = clipboardData.getData('text/plain');
      const items = clipboardData.items;
      
      console.log('HTML ë°ì´í„°:', html ? 'ìˆìŒ' : 'ì—†ìŒ');
      console.log('í…ìŠ¤íŠ¸ ë°ì´í„°:', text ? 'ìˆìŒ' : 'ì—†ìŒ');
      
      let processed = false;

      // 1. ì´ë¯¸ì§€ ìš°ì„  ì²˜ë¦¬ (ë³´ì•ˆ í™˜ê²½ ê³ ë ¤)
      for (let i = 0; i < items.length; i++) {
        const item = items[i];
        if (item.type.indexOf('image') !== -1) {
          const file = item.getAsFile();
          if (file) {
            try {
              const url = URL.createObjectURL(file);
              const container = document.createElement('div');
              container.className = 'image-container';
              const img = document.createElement('img');
              img.src = url;
              img.alt = 'ë¶™ì—¬ë„£ì€ ì´ë¯¸ì§€';
              container.appendChild(img);
              pasteArea.appendChild(container);
              updateItemCount();
              showStatus('ì´ë¯¸ì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
              processed = true;
            } catch (error) {
              // ì´ë¯¸ì§€ ì²˜ë¦¬ê°€ ë§‰íŒ ê²½ìš°
              const container = document.createElement('div');
              container.className = 'text-block';
              container.textContent = `[ì´ë¯¸ì§€] - í¬ê¸°: ${(file.size / 1024).toFixed(1)}KB, íƒ€ì…: ${file.type}`;
              pasteArea.appendChild(container);
              updateItemCount();
              showStatus('ì´ë¯¸ì§€ ì •ë³´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤ (ë¯¸ë¦¬ë³´ê¸° ì œí•œ)');
              processed = true;
            }
          }
        }
      }

      // 2. HTML ë°ì´í„° ì²˜ë¦¬ (ì—‘ì…€ í‘œ í¬í•¨)
      if (html && !processed) {
        console.log('HTML ë‚´ìš© ì²˜ë¦¬ ì¤‘...');
        
        // HTMLì„ ì„ì‹œ ìš”ì†Œì— íŒŒì‹±
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        
        // í…Œì´ë¸” ì°¾ê¸°
        const tables = tempDiv.querySelectorAll('table');
        if (tables.length > 0) {
          console.log(`í…Œì´ë¸” ${tables.length}ê°œ ë°œê²¬`);
          tables.forEach(table => {
            // í…Œì´ë¸” ì •ë¦¬
            cleanTableForDisplay(table);
            pasteArea.appendChild(table.cloneNode(true));
          });
          updateItemCount();
          showStatus(`ì—‘ì…€ í‘œ ${tables.length}ê°œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
          processed = true;
        } else {
          // í…Œì´ë¸”ì´ ì—†ëŠ” ê²½ìš° HTML ë‚´ìš© ì§ì ‘ ì¶”ê°€
          const cleanedHtml = cleanHtmlContent(html);
          if (cleanedHtml.trim()) {
            const div = document.createElement('div');
            div.innerHTML = cleanedHtml;
            pasteArea.appendChild(div);
            updateItemCount();
            showStatus('HTML ë‚´ìš©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
            processed = true;
          }
        }
      }

      // 3. í…ìŠ¤íŠ¸ ë°ì´í„° ì²˜ë¦¬ (ë°±ì—… ë˜ëŠ” ë…ë¦½)
      if (text && !processed) {
        console.log('í…ìŠ¤íŠ¸ ë‚´ìš© ì²˜ë¦¬ ì¤‘...');
        
        // íƒ­ìœ¼ë¡œ êµ¬ë¶„ëœ ë°ì´í„°ì¸ì§€ í™•ì¸ (ì—‘ì…€ ë°ì´í„°)
        if (text.includes('\t') && text.includes('\n')) {
          console.log('íƒ­ êµ¬ë¶„ ë°ì´í„° ê°ì§€ - í…Œì´ë¸”ë¡œ ë³€í™˜');
          const table = createTableFromText(text);
          if (table) {
            pasteArea.appendChild(table);
            updateItemCount();
            showStatus('í…ìŠ¤íŠ¸ê°€ í‘œë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
            processed = true;
          }
        }
        
        // ì¼ë°˜ í…ìŠ¤íŠ¸ ì²˜ë¦¬
        if (!processed) {
          const textBlock = document.createElement('div');
          textBlock.className = 'text-block';
          textBlock.textContent = text;
          pasteArea.appendChild(textBlock);
          updateItemCount();
          showStatus('í…ìŠ¤íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
          processed = true;
        }
      }

      if (!processed) {
        showStatus('ë¶™ì—¬ë„£ê¸° í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    });

    // í…Œì´ë¸” ì •ë¦¬ í•¨ìˆ˜
    function cleanTableForDisplay(table) {
      // ë¶ˆí•„ìš”í•œ ì†ì„± ì œê±°
      table.removeAttribute('style');
      table.removeAttribute('class');
      table.removeAttribute('cellpadding');
      table.removeAttribute('cellspacing');
      table.removeAttribute('border');
      
      // ëª¨ë“  ì…€ ì •ë¦¬
      const cells = table.querySelectorAll('td, th');
      cells.forEach(cell => {
        // ìŠ¤íƒ€ì¼ ì†ì„± ì œê±°
        cell.removeAttribute('style');
        cell.removeAttribute('class');
        cell.removeAttribute('width');
        cell.removeAttribute('height');
        
        // ë¹ˆ ì…€ ì²˜ë¦¬
        if (!cell.textContent.trim()) {
          cell.innerHTML = '&nbsp;';
        }
      });
    }

    // HTML ë‚´ìš© ì •ë¦¬
    function cleanHtmlContent(html) {
      // ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ ì œê±°
      html = html.replace(/<script[^>]*>.*?<\/script>/gi, '');
      // ìŠ¤íƒ€ì¼ íƒœê·¸ ì œê±°
      html = html.replace(/<style[^>]*>.*?<\/style>/gi, '');
      // ìœ„í—˜í•œ ì†ì„± ì œê±°
      html = html.replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi, '');
      return html;
    }

    // í…ìŠ¤íŠ¸ì—ì„œ í…Œì´ë¸” ìƒì„±
    function createTableFromText(text) {
      const rows = text.trim().split(/\r?\n/);
      if (rows.length < 2) return null;
      
      const table = document.createElement('table');
      
      rows.forEach((row, index) => {
        const tr = document.createElement('tr');
        const cells = row.split('\t');
        
        cells.forEach(cellText => {
          const cell = index === 0 ? document.createElement('th') : document.createElement('td');
          cell.textContent = cellText.trim() || '';
          tr.appendChild(cell);
        });
        
        table.appendChild(tr);
      });
      
      return table;
    }

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function focusPasteArea() {
      pasteArea.focus();
      showStatus('ë¶™ì—¬ë„£ê¸° ì˜ì—­ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function clearAll() {
      if (confirm('ëª¨ë“  ë‚´ìš©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        pasteArea.innerHTML = '<div class="item-info" id="itemInfo" style="display: none;">í•­ëª©: 0</div>';
        itemCount = 0;
        itemInfo.style.display = 'none';
        showStatus('ëª¨ë“  ë‚´ìš©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
      }
    }

    function downloadAsHtml() {
      if (itemCount === 0) {
        showStatus('ì €ì¥í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤!', 'error');
        return;
      }
      
      const content = pasteArea.innerHTML;
      const html = `<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¶™ì—¬ë„£ê¸° ë‚´ìš© - ${new Date().toLocaleDateString()}</title>
  <style>
    body { font-family: "Malgun Gothic", sans-serif; padding: 20px; line-height: 1.6; }
    table { border-collapse: collapse; width: 100%; margin: 16px 0; }
    table td, table th { border: 1px solid #ddd; padding: 8px 12px; }
    table th { background-color: #f8fafc; font-weight: 600; }
    img { max-width: 100%; height: auto; }
    .text-block { margin: 16px 0; padding: 16px; background: #f8fafc; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>ë¶™ì—¬ë„£ê¸° ë‚´ìš©</h1>
  <p>ìƒì„±ì¼: ${new Date().toLocaleString()}</p>
  <hr>
  ${content}
</body>
</html>`;
      
      try {
        // ë³´ì•ˆ PC í™˜ê²½ì—ì„œ ë‹¤ìš´ë¡œë“œ ì‹œë„
        const blob = new Blob([html], { type: 'text/html; charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `paste_content_${new Date().toISOString().slice(0, 10)}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showStatus('HTML íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } catch (error) {
        // ë‹¤ìš´ë¡œë“œê°€ ë§‰íŒ ê²½ìš° ëŒ€ì•ˆ ì œê³µ
        showHTMLPreview(html);
        showStatus('ë‹¤ìš´ë¡œë“œê°€ ì œí•œë˜ì–´ ë¯¸ë¦¬ë³´ê¸°ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.', 'error');
      }
    }
    
    function showHTMLPreview(html) {
      // ìƒˆ ì°½ì—ì„œ HTML ë‚´ìš© í‘œì‹œ (ë³´ì•ˆ í™˜ê²½ì—ì„œ ëŒ€ì•ˆ)
      const newWindow = window.open('', '_blank');
      if (newWindow) {
        newWindow.document.write(html);
        newWindow.document.close();
      } else {
        // ìƒˆ ì°½ë„ ë§‰íŒ ê²½ìš°, í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
        const pre = document.createElement('pre');
        pre.style.cssText = 'background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 6px; font-size: 12px; overflow: auto; max-height: 300px;';
        pre.textContent = html;
        pasteArea.appendChild(pre);
        showStatus('HTML ì½”ë“œê°€ ì•„ë˜ì— í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    function copyAllContent() {
      if (itemCount === 0) {
        showStatus('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤!', 'error');
        return;
      }
      
      try {
        // ìµœì‹  í´ë¦½ë³´ë“œ API ì‹œë„
        if (navigator.clipboard && navigator.clipboard.writeText) {
          const textContent = pasteArea.innerText;
          navigator.clipboard.writeText(textContent).then(() => {
            showStatus('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (ìµœì‹  API)');
          }).catch(() => {
            // fallback to legacy method
            copyWithLegacyMethod();
          });
        } else {
          copyWithLegacyMethod();
        }
      } catch (error) {
        copyWithLegacyMethod();
      }
    }
    
    function copyWithLegacyMethod() {
      try {
        const selection = window.getSelection();
        const range = document.createRange();
        range.selectNodeContents(pasteArea);
        selection.removeAllRanges();
        selection.addRange(range);
        
        const success = document.execCommand('copy');
        if (success) {
          showStatus('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (ë ˆê±°ì‹œ)');
        } else {
          throw new Error('ë³µì‚¬ ì‹¤íŒ¨');
        }
        
        selection.removeAllRanges();
      } catch (err) {
        // ë³µì‚¬ê°€ ì™„ì „íˆ ë§‰íŒ ê²½ìš° ì„ íƒë§Œ í•´ì£¼ê¸°
        const selection = window.getSelection();
        const range = document.createRange();
        range.selectNodeContents(pasteArea);
        selection.removeAllRanges();
        selection.addRange(range);
        showStatus('ë‚´ìš©ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤. Ctrl+Cë¡œ ë³µì‚¬í•˜ì„¸ìš”.', 'error');
      }
    }

    // ì´ˆê¸° ì„¤ì •
    pasteArea.focus();
    
    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'v') {
        // Ctrl+V ê°ì§€ ì‹œ í¬ì»¤ìŠ¤ í™•ì¸
        setTimeout(() => {
          if (document.activeElement !== pasteArea) {
            pasteArea.focus();
          }
        }, 10);
      }
    });
  </script>
</body>
</html>
