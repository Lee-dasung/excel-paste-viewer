<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>파파고 스타일 뷰어</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Malgun Gothic', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f7f9fc;
      padding: 20px;
      line-height: 1.5;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #1ec800, #0fb300);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 8px;
      font-weight: 700;
    }
    
    .header p {
      font-size: 16px;
      opacity: 0.9;
    }
    
    .main-content {
      padding: 30px;
    }
    
    .input-section {
      margin-bottom: 30px;
    }
    
    .input-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }
    
    /* 파파고 스타일 입력창 */
    .input-container {
      position: relative;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: white;
      transition: all 0.3s ease;
    }
    
    .input-container:focus-within {
      border-color: #1ec800;
      box-shadow: 0 0 0 4px rgba(30, 200, 0, 0.1);
    }
    
    .input-area {
      width: 100%;
      min-height: 200px;
      max-height: 400px;
      padding: 20px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-family: inherit;
      line-height: 1.6;
      resize: vertical;
      outline: none;
      background: transparent;
    }
    
    .input-area::placeholder {
      color: #9ca3af;
      font-style: normal;
    }
    
    /* 파파고 스타일 플레이스홀더 */
    .placeholder-text {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #9ca3af;
      font-size: 16px;
      pointer-events: none;
      transition: all 0.3s ease;
      white-space: pre-line;
    }
    
    .input-area:focus + .placeholder-text,
    .input-area:not(:placeholder-shown) + .placeholder-text {
      opacity: 0;
      transform: translateY(-10px);
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 10px 20px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background: white;
      color: #333;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn:hover {
      border-color: #1ec800;
      background: #f0fff4;
    }
    
    .btn-primary {
      background: #1ec800;
      color: white;
      border-color: #1ec800;
    }
    
    .btn-primary:hover {
      background: #16a085;
    }
    
    .result-section {
      border-top: 1px solid #f0f0f0;
      padding-top: 30px;
    }
    
    .result-area {
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      min-height: 200px;
      max-height: 500px;
      overflow: auto;
    }
    
    .empty-state {
      text-align: center;
      color: #9ca3af;
      font-style: italic;
      padding: 60px 20px;
    }
    
    /* 파파고 스타일 테이블 */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    
    table th, table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
    }
    
    table th {
      background: #f8fafc;
      font-weight: 600;
      color: #374151;
      font-size: 14px;
    }
    
    table tr:last-child td {
      border-bottom: none;
    }
    
    table tr:hover {
      background: #f9fafb;
    }
    
    .info-text {
      font-size: 12px;
      color: #6b7280;
      margin-top: 10px;
      text-align: center;
    }
    
    .status-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .status-indicator.show {
      transform: translateX(0);
    }
    
    .status-indicator.success {
      background: #10b981;
    }
    
    .status-indicator.error {
      background: #ef4444;
    }
    
    /* 파파고 스타일 로딩 */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #1ec800;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* 모바일 반응형 */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .main-content {
        padding: 20px;
      }
      
      .header {
        padding: 20px;
      }
      
      .header h1 {
        font-size: 24px;
      }
      
      .controls {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>📋 데이터 붙여넣기 뷰어</h1>
      <p>파파고 방식으로 구현된 안전한 클립보드 처리</p>
    </div>
    
    <div class="main-content">
      <div class="input-section">
        <label class="input-label">데이터 입력</label>
        <div class="input-container">
          <textarea 
            class="input-area" 
            id="dataInput"
            placeholder="여기에 엑셀 데이터를 붙여넣으세요...

🔸 엑셀에서 복사한 표 데이터
🔸 탭, 콤마, 공백으로 구분된 텍스트
🔸 CSV 형태의 데이터

보안 PC에서는 메모장을 경유해서 붙여넣어 보세요!"
          ></textarea>
        </div>
        
        <div class="controls">
          <button class="btn btn-primary" onclick="processData()">
            <span id="processBtn">📊 표로 변환</span>
          </button>
          <button class="btn" onclick="clearData()">🗑️ 지우기</button>
          <button class="btn" onclick="copyResult()">📋 결과 복사</button>
          <button class="btn" onclick="downloadCSV()">💾 CSV 다운로드</button>
        </div>
        
        <div class="info-text">
          💡 <strong>팁:</strong> Ctrl+V로 붙여넣기가 안 되면 메모장(notepad) → 복사 → 여기에 붙여넣기
        </div>
      </div>
      
      <div class="result-section">
        <label class="input-label">변환 결과</label>
        <div class="result-area" id="resultArea">
          <div class="empty-state">
            위에 데이터를 입력하고 "표로 변환" 버튼을 눌러주세요
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="status-indicator" id="statusIndicator"></div>

  <script>
    const dataInput = document.getElementById('dataInput');
    const resultArea = document.getElementById('resultArea');
    const statusIndicator = document.getElementById('statusIndicator');
    const processBtn = document.getElementById('processBtn');

    // 상태 메시지 표시
    function showStatus(message, type = 'success') {
      statusIndicator.textContent = message;
      statusIndicator.className = `status-indicator ${type} show`;
      setTimeout(() => {
        statusIndicator.classList.remove('show');
      }, 3000);
    }

    // 파파고 방식 이벤트 리스너들
    dataInput.addEventListener('paste', handlePaste);
    dataInput.addEventListener('input', handleInput);
    dataInput.addEventListener('change', handleInput);

    // 붙여넣기 이벤트 (파파고 방식)
    function handlePaste(event) {
      console.log('Paste event detected');
      
      // 기본 붙여넣기 동작은 그대로 두고, 추가 처리만 수행
      setTimeout(() => {
        const value = dataInput.value;
        if (value.trim()) {
          console.log('Pasted content:', value.substring(0, 100) + '...');
          showStatus('데이터가 붙여넣어졌습니다!');
          
          // 자동으로 표 형태인지 감지하여 미리보기
          if (detectTableData(value)) {
            setTimeout(() => {
              processData();
            }, 500);
          }
        }
      }, 100);
    }

    // 입력 변화 감지 (파파고 방식)
    function handleInput(event) {
      const value = dataInput.value.trim();
      if (value) {
        console.log('Input detected, length:', value.length);
      }
    }

    // 표 데이터 감지
    function detectTableData(text) {
      const lines = text.split('\n').filter(line => line.trim());
      if (lines.length < 2) return false;
      
      // 탭이나 콤마가 포함되어 있으면 표 데이터로 판단
      return lines[0].includes('\t') || lines[0].includes(',') || lines[0].includes('|');
    }

    // 데이터 처리 (파파고 방식)
    function processData() {
      const inputText = dataInput.value.trim();
      
      if (!inputText) {
        showStatus('처리할 데이터를 입력해주세요!', 'error');
        return;
      }

      // 로딩 표시
      processBtn.innerHTML = '<span class="loading"></span> 처리중...';
      
      setTimeout(() => {
        try {
          const result = parseTextToTable(inputText);
          resultArea.innerHTML = result;
          showStatus('표로 변환이 완료되었습니다!');
        } catch (error) {
          console.error('Processing error:', error);
          showStatus('데이터 처리 중 오류가 발생했습니다!', 'error');
        } finally {
          processBtn.innerHTML = '📊 표로 변환';
        }
      }, 300);
    }

    // 텍스트를 표로 변환 (파파고 방식)
    function parseTextToTable(text) {
      const lines = text.split('\n').filter(line => line.trim());
      
      if (lines.length === 0) {
        return '<div class="empty-state">변환할 데이터가 없습니다</div>';
      }

      // 구분자 자동 감지 (파파고 방식)
      let delimiter = detectDelimiter(lines[0]);
      
      console.log('Detected delimiter:', delimiter === '\t' ? 'TAB' : delimiter);
      
      let html = '<table>';
      
      lines.forEach((line, index) => {
        html += '<tr>';
        
        const cells = line.split(delimiter);
        cells.forEach(cellText => {
          const tag = index === 0 ? 'th' : 'td';
          const cleanText = cellText.trim() || '&nbsp;';
          html += `<${tag}>${cleanText}</${tag}>`;
        });
        
        html += '</tr>';
      });
      
      html += '</table>';
      
      // 정보 표시
      const delimiterName = delimiter === '\t' ? '탭' : 
                           delimiter === ',' ? '콤마' : 
                           delimiter === '|' ? '파이프' : '공백';
      
      html += `<div class="info-text">
        📊 ${lines.length}행 × ${lines[0].split(delimiter).length}열 
        (구분자: ${delimiterName})
      </div>`;
      
      return html;
    }

    // 구분자 감지 (파파고 방식)
    function detectDelimiter(line) {
      // 우선순위: 탭 > 콤마 > 파이프 > 공백
      if (line.includes('\t')) return '\t';
      if (line.includes(',')) return ',';
      if (line.includes('|')) return '|';
      return /\s+/; // 공백 (정규식)
    }

    // 데이터 지우기
    function clearData() {
      if (confirm('입력된 데이터를 모두 지우시겠습니까?')) {
        dataInput.value = '';
        resultArea.innerHTML = '<div class="empty-state">위에 데이터를 입력하고 "표로 변환" 버튼을 눌러주세요</div>';
        showStatus('데이터가 삭제되었습니다');
      }
    }

    // 결과 복사 (파파고 방식)
    function copyResult() {
      try {
        const tables = resultArea.querySelectorAll('table');
        if (tables.length === 0) {
          showStatus('복사할 표가 없습니다!', 'error');
          return;
        }

        // 표를 텍스트로 변환
        let textContent = '';
        tables[0].querySelectorAll('tr').forEach(row => {
          const cells = Array.from(row.querySelectorAll('th, td'));
          const rowText = cells.map(cell => cell.textContent.trim()).join('\t');
          textContent += rowText + '\n';
        });

        // 임시 textarea 생성해서 복사 (파파고 방식)
        const tempTextarea = document.createElement('textarea');
        tempTextarea.value = textContent;
        document.body.appendChild(tempTextarea);
        tempTextarea.select();
        
        if (document.execCommand('copy')) {
          showStatus('표가 클립보드에 복사되었습니다!');
        } else {
          throw new Error('복사 실패');
        }
        
        document.body.removeChild(tempTextarea);
      } catch (error) {
        showStatus('복사 기능이 제한되어 있습니다', 'error');
      }
    }

    // CSV 다운로드
    function downloadCSV() {
      const tables = resultArea.querySelectorAll('table');
      if (tables.length === 0) {
        showStatus('다운로드할 표가 없습니다!', 'error');
        return;
      }

      let csvContent = '';
      tables[0].querySelectorAll('tr').forEach(row => {
        const cells = Array.from(row.querySelectorAll('th, td'));
        const rowText = cells.map(cell => `"${cell.textContent.trim()}"`).join(',');
        csvContent += rowText + '\n';
      });

      try {
        const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv; charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `table_data_${new Date().toISOString().slice(0, 10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showStatus('CSV 파일이 다운로드되었습니다!');
      } catch (error) {
        showStatus('다운로드 기능이 제한되어 있습니다', 'error');
      }
    }

    // 키보드 단축키 (파파고 방식)
    document.addEventListener('keydown', function(event) {
      // Ctrl+Enter: 처리
      if (event.ctrlKey && event.key === 'Enter') {
        event.preventDefault();
        processData();
      }
      
      // Ctrl+L: 지우기
      if (event.ctrlKey && event.key === 'l') {
        event.preventDefault();
        clearData();
      }
    });

    // 초기화
    dataInput.focus();
    console.log('파파고 스타일 뷰어가 로드되었습니다');
  </script>
</body>
</html>
